<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
</head>
<style>
    /* общие стили для таблицы, изменять их не нужно */


     .edit-area {
        border: none;
        margin: 0;
        padding: 0;
        display: block;

        /* отключаем изменение размера мышью в Firefox */
        resize: none;

        /* удаляем обводку при фокусировке в Chrome */
        outline: none;

        /* удаляем полосу прокрутки в IE */
        overflow: auto;
    }
    .edit-td{
        border: none;
        margin: 0;
        padding: 0;
        display: block;

        /* отключаем изменение размера мышью в Firefox */
        resize: none;

        /* удаляем обводку при фокусировке в Chrome */
        outline: none;

        /* удаляем полосу прокрутки в IE */
        overflow: auto;
    }

    .edit-controls {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .edit-td {
        position: relative;
        padding: 0;
    }
    #bagua-table{
        margin: 0 auto;
        /*height: 800px;*/
    }

    th {
        text-align: center;
        font-weight: bold;
    }

    td {
        width: 400px;
        height: 200px;
        white-space: nowrap;
        text-align: center;
        vertical-align: middle;
        padding: 10px;
    }

    .nw {
        background-color: #999;
    }

    .n {
        background-color: #03f;
        color: #fff;
    }

    .ne {
        background-color: #ff6;
    }

    .w {
        background-color: #ff0;
    }

    .c {
        background-color: #60c;
        color: #fff;
    }

    .e {
        background-color: #09f;
        color: #fff;
    }

    .sw {
        background-color: #963;
        color: #fff;
    }

    .s {
        background-color: #f60;
        color: #fff;
    }

    .se {
        background-color: #0c3;
        color: #fff;
    }
    .bginner{
       background: none;
        position: relative;
    }

</style>
<body>


<p>Кликните на ячейку таблицы, чтобы отредактировать её. Нажмите ОК или ОТМЕНА, когда закончите.</p>

<table id="bagua-table">
    <tr>
        <th colspan="3">Квадрат <em>Bagua</em>: Направление, Элемент, Цвет, Значение</th>
    </tr>
    <tr>
        <td class="nw"><strong>Северо-Запад</strong>
            <br>Металл
            <br>Серебро
            <br>Старейшины
        </td>
        <td class="n"><strong>Север</strong>
            <br>Вода
            <br>Синий
            <br>Перемены
        </td>
        <td class="ne"><strong>Северо-Восток</strong>
            <br>Земля
            <br>Жёлтый
            <br>Направление
        </td>
    </tr>
    <tr>
        <td class="w"><strong>Запад</strong>
            <br>Металл
            <br>Золото
            <br>Молодость
        </td>
        <td class="c"><strong>Центр</strong>
            <br>Всё
            <br>Пурпурный
            <br>Гармония
        </td>
        <td class="e"><strong>Восток</strong>
            <br>Дерево
            <br>Синий
            <br>Будущее
        </td>
    </tr>
    <tr>
        <td class="sw"><strong>Юго-Запад</strong>
            <br>Земля
            <br>Коричневый
            <br>Спокойствие
        </td>
        <td class="s"><strong>Юг</strong>
            <br>Огонь
            <br>Оранжевый
            <br>Слава
        </td>
        <td class="se"><strong>Юго-Восток</strong>
            <br>Дерево
            <br>Зеленый
            <br>Роман
        </td>
    </tr>

</table>


<script>
    let table = document.getElementById('bagua-table');

    table.addEventListener('click',edit)

    function  edit(e) {
        let td = e.target.closest('td')
        if (td === null) return;

        table.classList.add('edit')
        let textArea = document.createElement('textarea')

        textArea.style.height = td.getBoundingClientRect().height-20+'px'
        textArea.style.width = td.getBoundingClientRect().width-20+'px'
        let storyCancel = td.innerHTML
        textArea.value = td.innerHTML;

        td.innerHTML = ''
        td.classList.add('bginner')
        td.append(textArea)

        td.insertAdjacentHTML("beforeend","<div class=\"edit-controls\"><button class=\"edit-ok\">OK</button><button class=\"edit-cancel\">CANCEL</button></div>")

        document.querySelector('.edit-ok').addEventListener('click',editOk)
        document.querySelector('.edit-cancel').addEventListener('click',cancel)

        function editOk(e){
            td.innerHTML = textArea.value
            textArea.remove()
            td.classList.remove('bginner')
            table.addEventListener('click', edit, false);

        }
        function cancel(e){
            td.innerHTML = storyCancel
            textArea.remove()
            td.classList.remove('bginner')
            table.addEventListener('click', edit, false);

        }

        table.removeEventListener('click', edit, false);
    }
</script>

</body>

</html>